{"pageProps":{"markdownPost":{"name":null,"url":null,"content":"<!--[meta]\nsection: guides\ntitle: Cache hints\nsubSection: advanced\n[meta]-->\n\n# Cache hints\n\nAutomatically set HTTP cache headers and save full responses in a cache. For more information please see the [Apollo docs](https://www.apollographql.com/docs/apollo-server/performance/caching/) and the [HTTP spec](https://tools.ietf.org/html/rfc7234#section-5.2.2/).\n\n### Setting a default `maxAge`\n\nBy default, all queries and mutations keystone generates have a `maxAge` of 0 (ie, uncacheable). You can update this behaviour by specifying a default max age when creating the `GraphQLApp`.\n\n```javascript\nconst app = new GraphQLApp({\n  apollo: {\n    cacheControl: {\n      defaultMaxAge: 3600,\n    },\n  },\n});\n```\n\nPlease see the [Apollo docs](https://www.apollographql.com/docs/apollo-server/performance/caching/#setting-a-default-maxage) for more information.\n\n### Lists / fields\n\nCache hints can be set on lists and fields like so:\n\n```javascript\nkeystone.createList('Post', {\n  fields: {\n    title: {\n      type: Text,\n    },\n    description: {\n      type: Text,\n      cacheHint: {\n        maxAge: 80,\n      },\n    },\n  },\n  cacheHint: {\n    scope: 'PUBLIC',\n    maxAge: 3600,\n  },\n});\n```\n\nOnly static cache hints are supported at the field level, but for lists cache hints can be dynamically returned from a function that takes an object with these members:\n\n- `results`: an array of query results\n- `operationName`: the name of the GraphQL operation that generated the results\n- `meta`: boolean value that's true for a meta (count) query\n\n```javascript\nkeystone.createList('Post', {\n  fields: {\n    title: { type: Text },\n  },\n  cacheHint: ({ meta }) => {\n    if (meta) {\n      return {\n        scope: 'PUBLIC',\n        maxAge: 3600,\n      };\n    } else {\n      return {\n        scope: 'PRIVATE',\n        maxAge: 60,\n      };\n    }\n  },\n});\n```\n\n### Custom queries\n\nStatic cache hints can be set for custom queries generated using the `keystone.extendGraphQLSchema()` method.\n\n```javascript\nkeystone.extendGraphQLSchema({\n  types: [{ type: 'type MyType { original: Int, double: Float }' }],\n  queries: [\n    {\n      schema: 'double(x: Int): MyType',\n      resolver: (_, { x }) => ({ original: x, double: 2.0 * x }),\n      cacheHint: {\n        scope: 'PUBLIC',\n        maxAge: 100,\n      },\n    },\n  ],\n});\n```\n\n### Options\n\n- `scope`: `'PUBLIC'` or `'PRIVATE'` (corresponds to `public` and `private` `Cache-Control` directives)\n- `maxAge`: maximum age (in seconds) that the result should be cacheable for\n\n`PRIVATE` is a recommendation that browsers should cache the result, but forbids intermediate caches (like CDNs or corporate proxies) from storing it. It needs to be used whenever the result depends on the logged in user (including secrets and user-specific content like profile information). If the result could be different when a user logs in, `PRIVATE` should still be used even if no user is logged in.\n"}},"__N_SSG":true}