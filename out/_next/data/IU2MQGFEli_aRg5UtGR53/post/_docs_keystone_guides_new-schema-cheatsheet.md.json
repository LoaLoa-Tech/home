{"pageProps":{"markdownPost":{"name":null,"url":null,"content":"<!--[meta]\nsection: guides\ntitle: New schema cheatsheet\n[meta]-->\n\n# New schema cheatsheet\n\nThis cheatsheet summarises the changes needed to update your database to use the new Keystone database schema, introduced in the [`Arcade`](/docs/discussions/new-data-schema.md) release.\nFor full instructions please consult the [migration guide](/docs/guides/relationship-migration.md).\n\n## One-to-many (one-sided)\n\n```javascript\nkeystone.createList('User', { fields: { name: { type: Text } } });\n\nkeystone.createList('Post', {\n  fields: {\n    title: { type: Text },\n    content: { type: Text },\n    author: { type: Relationship, ref: 'User', many: false },\n  },\n});\n```\n\n### Migration strategy\n\n- No changes are required for these relationships.\n\n## Many-to-many (one-sided)\n\n```javascript\nkeystone.createList('User', { fields: { name: { type: Text } } });\n\nkeystone.createList('Post', {\n  fields: {\n    title: { type: Text },\n    content: { type: Text },\n    authors: { type: Relationship, ref: 'User', many: true },\n  },\n});\n```\n\n### Migration Strategy\n\n#### PostgreSQL\n\n- Rename `Post_authors` to `Post_authors_many`.\n- Rename `Post_id` to `Post_left_id` and `User_id` to `User_right_id`.\n\n#### MongoDB\n\n- Create a collection `post_authors_manies` with fields `Post_left_id` and `User_right_id`.\n- Move the data from `posts.authors` into `post_authors_manies`.\n- Delete `posts.authors`.\n\n## One-to-many (two-sided)\n\n```javascript\nkeystone.createList('User', {\n  fields: {\n    name: { type: Text },\n    posts: { type: Relationship, ref: 'Post.author', many: true },\n  },\n});\n\nkeystone.createList('Post', {\n  fields: {\n    title: { type: Text },\n    content: { type: Text },\n    author: { type: Relationship, ref: 'User.posts', many: false },\n  },\n});\n```\n\n### Migration strategy\n\n#### PostgreSQL\n\n- Drop the `User_posts` table.\n\n#### MongoDB\n\n- Remove `users.posts`.\n\n## Many-to-many (two-sided)\n\n```javascript\nkeystone.createList('User', {\n  fields: {\n    name: { type: Text },\n    posts: { type: Relationship, ref: 'Post.authors', many: true },\n  },\n});\n\nkeystone.createList('Post', {\n  fields: {\n    title: { type: Text },\n    content: { type: Text },\n    authors: { type: Relationship, ref: 'User.posts', many: true },\n  },\n});\n```\n\n### Migration strategy\n\n#### PostgreSQL\n\n- Drop the `Post_authors` table.\n- Rename `User_posts` to `User_posts_Post_authors`.\n- Rename `User_id` to `User_left_id` and `Post_id` to `Post_right_id`.\n\n#### MongoDB\n\n- Create a collection `user_posts_post_authors` with fields `User_left_id` and `Post_right_id`.\n- Move the data from `users.posts` into `user_posts_post_authors`.\n- Delete `users.posts`.\n- Delete `posts.authors`.\n\n## One-to-one (two-sided)\n\n```javascript\nkeystone.createList('User', {\n  fields: {\n    name: { type: Text },\n    post: { type: Relationship, ref: 'Post.author', many: false },\n  },\n});\n\nkeystone.createList('Post', {\n  fields: {\n    title: { type: Text },\n    content: { type: Text },\n    author: { type: Relationship, ref: 'User.post', many: false },\n  },\n});\n```\n\n### Migration strategy\n\n#### PostgreSQL\n\nOne to one relationships in the `before` state had a foreign key column on each table.\nIn the `after` state, only one of these is stored.\nBecause of the symmetry of the one-to-one relationship, Keystone makes an arbitrary decision about which column to use.\n\n- Identify the foreign key column which is no longer required, and delete it.\n- In our example above we would delete the `Post.author` column.\n\n#### MongoDB\n\nOne to one relationships in the `before` state had a field in each collection.\nIn the `after` state, only one of these is stored.\nBecause of the symmetry of the one-to-one relationship, Keystone makes an arbitrary decision about which field to use.\n\n- Identify the field which is no longer required, and delete it.\n- In our example above we would delete the `post.author` field.\n"}},"__N_SSG":true}