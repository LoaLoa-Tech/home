{"pageProps":{"markdownPost":{"name":null,"url":null,"content":"---\ntitle: Migrating to Apollo Client 3.0\n---\n\nimport {VideoFrame} from 'gatsby-theme-apollo-docs'\n\nThis article walks you through migrating your application to Apollo Client 3.0 from previous versions of Apollo Client. \n\nTo illustrate the migration process, we've also made this video that uses the example app from our [full-stack tutorial](https://www.apollographql.com/docs/tutorial/introduction/) as a starting point, updating it from Apollo client 2.6 to 3.0: \n\n<VideoFrame src=\"https://www.youtube.com/embed/dlKzlksOUtU\" />\n\n## What’s new in 3.0\n\n* Apollo Client is now distributed as the `@apollo/client` package (previous versions are distributed as `apollo-client`).\n* The `@apollo/client` package includes both React hooks and GraphQL request handling, which previously required installing separate packages.\n* Apollo Client’s cache (`InMemoryCache`) is more flexible and performant. It now supports garbage collection, storage of both normalized and non-normalized data, and the customization of cached data with new `TypePolicy` and `FieldPolicy` APIs.\n* The update also includes numerous bug fixes and optimizations, as described in the [changelog](https://github.com/apollographql/apollo-client/blob/main/CHANGELOG.md).\n\n## Installation\n\n> **WARNING:** Apollo Client 3.0 is a major-version release that includes **breaking changes**. If you are updating an existing application to use Apollo Client 3.0, please see the [changelog](https://github.com/apollographql/apollo-client/blob/main/CHANGELOG.md) for details about these changes.\n\nInstall Apollo Client 3.0 with the following command:\n\n```\nnpm install @apollo/client\n```\n\nIf you’re installing Apollo Client 3.0 in a project that already uses an earlier version, follow the instructions in each section of [Updating imports](#updating-imports) that applies to a library you are currently using.\n\n## Updating imports\n\nThe `@apollo/client` library includes functionality that previously required installing additional packages. As part of migrating to Apollo Client 3.0, follow the instructions below for each library your application currently uses.\n\n> To simplify the process of converting your `import` declarations from older packages to `@apollo/client`, we provide an automated [transform](https://github.com/apollographql/apollo-client/tree/main/codemods/ac2-to-ac3) based on [`jscodeshift`](https://www.npmjs.com/package/jscodeshift). Note that this transform merely moves `import` specifiers between `import` declarations, without checking for proper usage of the imported values. Since the transform cannot take care of everything, pay close attention to any errors produced by TypeScript or your bundling tools, and be sure to verify all changes made by the transform. A more detailed list of caveats can be found in the [`README.md`](https://github.com/apollographql/apollo-client/tree/main/codemods/ac2-to-ac3#known-limitations).\n\n### @apollo/react-hoc and @apollo/react-components\n\nReact Apollo HOC and component functionality is now included in the `@apollo/client` package:\n\n```js\nimport { Query, Mutation, Subscription } from '@apollo/client/react/components';\nimport { graphql } from '@apollo/client/react/hoc';\n```\n\nAs part of migrating, we recommend removing all `@apollo/react-hoc` and `@apollo/react-components` dependencies.\n\n### @apollo/react-hooks\n\nAll `@apollo/react-hooks` functionality is included in the `@apollo/client` package. For example:\n\n```js\nimport { ApolloProvider, useQuery, useApolloClient } from '@apollo/client'\n```\n\nAs part of migrating, we recommend removing all `@apollo/react-hooks` dependencies.\n\n### @apollo/react-ssr\n\nReact Apollo’s SSR utilities (like `getDataFromTree`, `getMarkupFromTree`, and `renderToStringWithData`) are included in the `@apollo/client` package. Access them via `@apollo/client/react/ssr`:\n\n```js\nimport { renderToStringWithData } from '@apollo/client/react/ssr';\n```\n\nAs part of migrating, we recommend removing all `@apollo/react-ssr` dependencies.\n\n### @apollo/react-testing\n\nReact Apollo’s testing utilities (like `MockedProvider`) are included in the `@apollo/client` package. Access them via `@apollo/client/testing`:\n\n```js\nimport { MockedProvider } from '@apollo/client/testing';\n```\n\nAs part of migrating, we recommend removing all `@apollo/react-testing` dependencies.\n\n### apollo-boost\n\nThe Apollo Boost project is now retired, because Apollo Client 3.0 provides a similarly straightforward setup. We recommend removing all `apollo-boost` dependencies and modifying your `ApolloClient` constructor as needed.\n\n### apollo-client\n\nWith Apollo Client 3.0, the `apollo-client` package is retired in favor of `@apollo/client`. As part of migrating, remove all `apollo-client` dependencies.\n\n### apollo-link and apollo-link-http\n\nAll `apollo-link`, `apollo-link-http`, and `apollo-link-http-common` functionality is included in the `@apollo/client` package. For example:\n\n```js\nimport { ApolloLink, HttpLink, from, split, execute } from '@apollo/client';\n```\n\nAs part of migrating, we recommend removing all `apollo-link`, `apollo-link-http`, and `apollo-link-http-common` dependencies.\n\nIf you want to configure your own link chain, the `ApolloClient` constructor still accepts a link option. Otherwise, the `ApolloClient` constructor now also supports `uri`, `headers`, and `credentials` options. For example:\n\n```js\nconst client = new ApolloClient({\n  cache,\n  uri: 'http://localhost:4000/graphql',\n  headers: {\n    authorization: localStorage.getItem('token') || '',\n    'client-name': 'Space Explorer [web]',\n    'client-version': '1.0.0',\n  },\n  ...\n});\n```\n\nThese options are passed into a new `HttpLink` instance behind the scenes, which `ApolloClient` is then configured to use.\n\n### apollo-link-*\n\nThe separate `apollo-link-*` packages, that were previously maintained in the https://github.com/apollographql/apollo-link repo, have been merged into the Apollo Client project. These links now have their own nested `@apollo/client` entry points. Imports should be updated as follows:\n\n* `apollo-link-batch` is now `@apollo/client/link/batch`\n* `apollo-link-batch-http` is now `@apollo/client/link/batch-http`\n* `apollo-link-context` is now `@apollo/client/link/context`\n* `apollo-link-error` is now `@apollo/client/link/error`\n* `apollo-link-retry` is now `@apollo/client/link/retry`\n* `apollo-link-schema` is now `@apollo/client/link/schema`\n* `apollo-link-ws` is now `@apollo/client/link/ws`\n\nIt is important to note that Apollo Client 3 no longer allows `@client` fields to be passed through a Link chain. While Apollo Client 2 made it possible to intercept `@client` fields in Link's like `apollo-link-state` and `apollo-link-schema`, Apollo Client 3 enforces that `@client` fields are local only. This helps ensure Apollo Client's local state story is easier to understand, and prevents unwanted fields from accidentally ending up in network requests ([PR #5982](https://github.com/apollographql/apollo-client/pull/5982)).\n\n### graphql-anywhere\n\nThe `graphql-anywhere` package’s functionality is no longer included with Apollo Client. You can continue to use the `graphql-anywhere` package, but Apollo no longer uses it and will not actively support it moving forward.\n\n### graphql-tag\n\nThe `@apollo/client` package includes `graphql-tag` as a dependency and re-exports `gql`. To simplify your dependencies, we recommend importing gql from `@apollo/client` and removing all `graphql-tag` dependencies.\n\n### react-apollo\n\n`react-apollo` v3 is an umbrella package that re-exports the following packages:\n\n- `@apollo/react-common`\n- `@apollo/react-hooks`\n- `@apollo/react-components`\n- `@apollo/react-hoc`\n- `@apollo/react-ssr`\n- `@apollo/react-testing`\n\nThe `react-apollo` package has been deprecated, and the functionality offered by each of the above packages can now be accessed from `@apollo/client` directly:\n\n- `@apollo/react-hooks` -> now available directly from `@apollo/client`\n- `@apollo/react-components` -> now available from `@apollo/client/react/components`\n- `@apollo/react-hoc` -> now available from `@apollo/client/react/hoc`\n- `@apollo/react-ssr` -> now available from `@apollo/client/react/ssr`\n- `@apollo/react-testing` -> now available from `@apollo/client/testing`\n\n## Using individual components of Apollo Client 3\n\nApollo Client 3.0 provides multiple entry points for you to import from. If you only use a particular part of Apollo Client’s functionality, you can import that functionality from its corresponding entry point. By doing so, modern bundlers can omit the remainder of the `@apollo/client` package from your bundle and reduce its size considerably.\n\n### Using Apollo Client without React\n\nApollo Client 3.0 includes built-in support for React hooks, but it absolutely still supports non-React view layers. To use Apollo Client 3.0 with Vue, Angular, or another view layer of your choosing, import `ApolloClient` from the `@apollo/client/core` entry point:\n\n```js\nimport { ApolloClient } from '@apollo/client/core';\n```\n\n### Using apollo-utilities without the rest of Apollo Client\n\nThe `apollo-utilities` package has been removed, but you can access the utilities themselves from the `@apollo/client/utilities` entry point:\n\n```js\nimport { isReference, isInlineFragment } from '@apollo/client/utilities';\n```\n\n### Using apollo-cache and/or apollo-cache-inmemory without the rest of Apollo Client\n\nThe `apollo-cache` and `apollo-cache-inmemory` packages have been removed, but if you're interested in using Apollo Client's cache by itself, you can access their contents with the `@apollo/client/cache` entry point:\n\n```js\nimport { ApolloCache, InMemoryCache } from '@apollo/client/cache';\n```\n\n## Cache improvements\n\nApollo Client 3.0 introduces powerful improvements to its caching system. Most of these improvements are backward compatible, so most applications will continue to work without any changes to caching logic. However, we highly recommend learning more about the capabilities of the Apollo Client 3.0 cache.\n\n* [Configuring the cache](../caching/cache-configuration/)\n* [Interacting with cached data](../caching/cache-interaction/)\n\n### Breaking cache changes\n\nThe following cache changes are **not** backward compatible. Take them into consideration before you upgrade to Apollo Client 3.0.\n\n* By default, the `InMemoryCache` no longer merges the fields of two objects unless those objects have the same unique identifier and that identifier is present in both objects. Additionally, the values of fields with the same name are no longer merged recursively by default. You can define a custom `merge`  function for a field to handle both of these changes for a particular field. You can read more about these changes in [Merging non-normalized objects](../caching/cache-field-behavior/#merging-non-normalized-objects). ([PR #5603](https://github.com/apollographql/apollo-client/pull/5603)).\n* All cache results are now frozen/immutable, as promised in the [Apollo Client 2.6 blog post](https://blog.apollographql.com/whats-new-in-apollo-client-2-6-b3acf28ecad1) ([PR #5153](https://github.com/apollographql/apollo-client/pull/5153)).\n* `FragmentMatcher`, `HeuristicFragmentMatcher`, and `IntrospectionFragmentMatcher` have all been removed. We recommend using the `InMemoryCache`’s `possibleTypes` option instead. For more information, see [Defining possibleTypes manually](../data/fragments/#defining-possibletypes-manually) ([PR #5073](https://github.com/apollographql/apollo-client/pull/5073)).\n* The internal representation of normalized data in the cache has changed. If you’re using `apollo-cache-inmemory`’s public API, then these changes shouldn’t impact you. If you are manipulating cached data directly instead, review [PR #5146](https://github.com/apollographql/apollo-client/pull/5146) for details.\n* `client|cache.writeData` have been fully removed. `client|cache.writeQuery`, `client|cache.writeFragment`, and/or `cache.modify` can be used to update the cache. For example:\n\n  ```js\n    client.writeData({\n      data: {\n        cartItems: []\n      }\n    });\n  ```\n\n  can be converted to:\n\n  ```js\n    client.writeQuery({\n      query: gql`\n        query GetCartItems {\n          cartItems\n        }\n      `,\n      data: {\n        cartItems: []\n      }\n    });\n  ```\n\n  For more details around why `writeData` has been removed, see [PR #5923](https://github.com/apollographql/apollo-client/pull/5923).\n"}},"__N_SSG":true}