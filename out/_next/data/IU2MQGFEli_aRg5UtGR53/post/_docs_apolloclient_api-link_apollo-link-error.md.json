{"pageProps":{"markdownPost":{"name":null,"url":null,"content":"---\ntitle: Error Link\ndescription: Handle and inspect errors in your GraphQL network stack.\n---\n\n## Overview\n\nUse this link to perform some custom logic when a GraphQL or network error happens:\n\n```js\nimport { onError } from \"@apollo/client/link/error\";\n\nconst link = onError(({ graphQLErrors, networkError }) => {\n  if (graphQLErrors)\n    graphQLErrors.map(({ message, locations, path }) =>\n      console.log(\n        `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`\n      )\n    );\n  if (networkError) console.log(`[Network error]: ${networkError}`);\n});\n```\n\n## Callback\n\nThe Error link takes a function that is called in the event of an error. This function is called with an object containing the following keys:\n\n| Option | Description |\n| - | - |\n| `operation` | The Operation that errored |\n| `response` | The result returned from lower down in the link chain |\n| `graphQLErrors` | An array of errors from the GraphQL endpoint |\n| `networkError` | Any error during the link execution or server response, that wasn't delivered as part of the `errors` field in the GraphQL result |\n| `forward` | A reference to the next link in the chain. Calling `return forward(operation)` in the callback will retry the request, returning a new observable for the upstream link to subscribe to. |\n\nReturns: `Observable<FetchResult> | void` The error callback can optionally return an observable from calling `forward(operation)` if it wants to retry the request. It should not return anything else.\n\n## Error categorization\n\nAn error is passed as a `networkError` if a link further down the chain called the `error` callback on the observable. In most cases, `graphQLErrors` is the `errors` field of the result from the last `next` call.\n\nA `networkError` can contain additional fields, such as a GraphQL object in the case of a failing HTTP status code. In this situation, `graphQLErrors` is an alias for `networkError.result.errors` if the property exists.\n\n## Retrying failed requests\n\nAn error handler might want to do more than just logging errors. You can check for a certain failure condition or error code, and retry the request if rectifying the error is possible. For example, when using some form of token based authentication, there is a need to handle re-authentication when the token expires. Here is an example of how to do this using `forward()`:\n\n```js\nonError(({ graphQLErrors, networkError, operation, forward }) => {\n  if (graphQLErrors) {\n    for (let err of graphQLErrors) {\n      switch (err.extensions.code) {\n        case 'UNAUTHENTICATED':\n          // error code is set to UNAUTHENTICATED\n          // when AuthenticationError thrown in resolver\n\n          // modify the operation context with a new token\n          const oldHeaders = operation.getContext().headers;\n          operation.setContext({\n            headers: {\n              ...oldHeaders,\n              authorization: getNewToken(),\n            },\n          });\n          // retry the request, returning the new observable\n          return forward(operation);\n      }\n    }\n  }\n  if (networkError) {\n    console.log(`[Network error]: ${networkError}`);\n    // if you would also like to retry automatically on\n    // network errors, we recommend that you use\n    // @apollo/client/link/retry\n  }\n});\n```\n\nHere is a diagram of the request flow:\n![Diagram of request flow after retrying in error links](../../assets/link/error-request-flow.png)\n\nOne caveat is that the errors in the new response, from retrying the request, do not get passed into the error handler again. This helps avoid being trapped in an endless request loop when you call `forward()` in your error handler.\n\n## Ignoring errors\n\nIf you want to conditionally ignore errors, you can set `response.errors = null;` within the error handler:\n\n```js\nonError(({ response, operation }) => {\n  if (operation.operationName === \"IgnoreErrorsQuery\") {\n    response.errors = null;\n  }\n});\n```\n"}},"__N_SSG":true}