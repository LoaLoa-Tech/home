{"pageProps":{"markdownPost":{"name":null,"url":null,"content":"---\ntitle: Compiling queries with Babel\n---\n\nIf you prefer co-locating your GraphQL queries in your Javascript files, you typically use the [graphql-tag](https://github.com/apollographql/graphql-tag) library to write them. That requires to process the query strings into a GraphQL AST, which will add to the startup time of your application, especially if you have many queries.\n\nTo avoid this runtime overhead, you can precompile your queries created with `graphql-tag` using [Babel](http://babeljs.io/). Here are two ways you can do this:\n\n1. Using [babel-plugin-graphql-tag](#using-babel-plugin-graphql-tag)\n2. Using [graphql-tag.macro](#using-graphql-tagmacro)\n\nIf you prefer to keep your GraphQL code in separate files (`.graphql` or `.gql`) you can use [babel-plugin-import-graphql](https://github.com/detrohutt/babel-plugin-import-graphql). This plugin still uses `graphql-tag` under the hood, but transparently. You simply `import` your operations/fragments as if each were an export from your GraphQL file. This carries the same precompilation benefits as the above approaches.\n\n## Using babel-plugin-graphql-tag\n\nThis approach will allow you to use the `graphql-tag` library as usual, and when processing the files with this babel plugin, the calls to that library will be replaced by the precompiled result.\n\nInstall the plugin in your dev dependencies:\n\n```\n# with npm\nnpm install --save-dev babel-plugin-graphql-tag\n\n# or with yarn\nyarn add --dev babel-plugin-graphql-tag\n```\n\nThen add the plugin in your `.babelrc` configuration file:\n\n```\n{\n  \"plugins\": [\n    \"graphql-tag\"\n  ]\n}\n```\n\nAnd that's it! All the usages of `import gql from 'graphql-tag'` will be removed, and the calls to `gql` will be replaced by the compiled version.\n\n## Using graphql-tag.macro\n\nThis approach is a bit more explicit, since you change all your usages of `graphql-tag` for `graphql-tag.macro`, which exports a `gql` function that you can use the same way as the original one. This macro requires the [babel-macros](https://github.com/kentcdodds/babel-macros) plugin, which will do the same as the previous approach but only on the calls that come from the macro import, leaving regular calls to the `graphql-tag` library untouched.\n\nWhy would you prefer this approach? Mainly because it requires less configuration (`babel-macros` works with all kinds of macros, so if you already had it installed you don't have to do anything else), and also because of the explicitness. You can read more about the rationale of using `babel-macros` [in this blog post](http://babeljs.io/blog/2017/09/11/zero-config-with-babel-macros).\n\nTo use it, provided that you [already have babel-macros installed](https://github.com/kentcdodds/babel-macros#installation) and [configured](https://github.com/kentcdodds/babel-macros/blob/master/other/docs/user.md), you just need to change this:\n\n```js\nimport gql from 'graphql-tag';\n\nconst query = gql`\n  query HelloWorld {\n    hello {\n      world\n    }\n  }\n`;\n```\n\nto this:\n\n```js\nimport gql from 'graphql-tag.macro'; // <-- Use the macro\n\nconst query = gql`\n  query HelloWorld {\n    hello {\n      world\n    }\n  }\n`;\n```\n\n## Using babel-plugin-import-graphql\n\nInstall the plugin in your dev dependencies:\n\n```\n# with npm\nnpm install --save-dev babel-plugin-import-graphql\n\n# or with yarn\nyarn add --dev babel-plugin-import-graphql\n```\n\nThen add the plugin in your `.babelrc` configuration file:\n\n```\n{\n  \"plugins\": [\n    \"import-graphql\"\n  ]\n}\n```\n\nNow any `import` statements importing from a GraphQL file type will return a ready-to-use GraphQL DocumentNode object.\n\n```jsx\nimport React, { Component } from 'react';\nimport { graphql } from '@apollo/react-hoc';\nimport myImportedQuery from './productsQuery.graphql';\n// or for files with multiple operations:\n// import { query1, query2 } from './queries.graphql';\n\nclass QueryingComponent extends Component {\n  render() {\n    if (this.props.data.loading) return <h3>Loading...</h3>;\n    return <div>{`This is my data: ${this.props.data.queryName}`}</div>;\n  }\n}\n\nexport default graphql(myImportedQuery)(QueryingComponent);\n```\n\n## Fragments\n\nAll of these approaches support the use of fragments.\n\nFor the first two approaches, you can have fragments defined in a different call to `gql` (either in the same file or in a different one). You can then include them into the main query using interpolation, like this:\n\n```js\nimport gql from 'graphql-tag';\n// or import gql from 'graphql-tag.macro';\n\nconst fragments = {\n  hello: gql`\n    fragment HelloStuff on Hello {\n      universe\n      galaxy\n    }\n  `\n};\n\nconst query = gql`\n  query HelloWorld {\n    hello {\n      world\n      ...HelloStuff\n    }\n  }\n\n  ${fragments.hello}\n`;\n```\n\nWith `babel-plugin-import-graphql`, you can just include your fragment in your GraphQL file along-side whatever uses it, or even import it from a separate file using the `#import` syntax. See the [README](https://github.com/detrohutt/babel-plugin-import-graphql) for more information.\n"}},"__N_SSG":true}