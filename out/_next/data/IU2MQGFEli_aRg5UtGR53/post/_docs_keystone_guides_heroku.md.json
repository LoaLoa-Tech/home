{"pageProps":{"markdownPost":{"name":null,"url":null,"content":"<!--[meta]\nsection: guides\ntitle: Heroku\nsubSection: deployment\n[meta]-->\n\n# Deploying Keystone to Heroku\n\nThis quick start guide shows how to deploy your first KeystoneJS app to Heroku and use MongoDB Atlas as our database service.\n\n## Requirements\n\nBefore we start, make sure you have [Git](https://git-scm.com/downloads) installed with `git --version`, and that you have created your first KeystoneJS app.\n\nIf not, see the guide [Your first KeystoneJS app in 5 minutes](https://www.keystonejs.com/quick-start/).\n\n> **Note:** Deploying [the STARTER starter project](#deploy-the-starter-starter-project) requires a few tweaks.\n\n## MongoDB Atlas\n\nMongoDB Atlas has a free tier that we can use as our database service. You need to create an account, but you can use the free tier.\n\n- Create [MongoDB Atlas](https://www.mongodb.com/cloud/atlas/signup) account and add a free tier Cluster.\n\n### Allow Heroku to access our database\n\n- Make sure to enable access from any network by going to SECURITY/Network Access, press [+Add ip address], [Allow access from anywhere] and confirm. This should add a rule that allow traffic from 0.0.0.0/0 (all networks).\n\n### Create a new user and get the database connection string\n\n- Go to SECURITY/Database access, press [+Add new database user] and create a new user with read and write privileges.\n\n- Take a note of the database connection string by selecting Clusters, press [Connect], [Connect your application], select Node.js and copy the connection string. It should look something like this `mongodb+srv://<username>:<password>@cluster0-szafh.azure.mongodb.net/test?retryWrites=true&w=majority`.\n\n## Heroku\n\nAlso Heroku has a free option. To use that we need to start to create a new account and install Heroku CLI.\n\n### Install Heroku CLI\n\nHeroku CLI is used to push the app to Heroku.\n\n- Download and install [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli).\n\n### Create a new Heroku app\n\n- Create an account on [Heroku](https://heroku.com).\n- A new app can then be [created from the dashboard](https://dashboard.heroku.com/new-app).\n\n### Setup your database connection\n\nKeystoneJS automatically fetches the database connection string from an environment variable. And as Heroku apps also can handle environment variables we use that to provide our database connection string to the KeystonJS app.\n\n- Go to your Heroku app in the dashboard, select Settings and press [Reveal config vars].\n\n- Create a new environment variable called `MONGO_URI` set it to the database connection string we got from MongoDB Atlas, e.g. `mongodb+srv://<username>:<password>@cluster0-szafh.azure.mongodb.net/test?retryWrites=true&w=majority`.\n\n### Push the KeystoneJS app to Heroku\n\nMake sure you are in the root folder of your newly created KeystoneJS app and run below commands.\n\nLogin to Heroku CLI\n\n```sh\nheroku login\n```\n\nInitialize a new git repo and add it to Heroku Git\n\n```sh\ngit init\nheroku git:remote -a <heroku-app-name>\n```\n\nCommit you app and push it to Heroku\n\n```sh\ngit add .\ngit commit -am \"initial commit\"\ngit push heroku master\n```\n\nYour KeystoneJS project is now pushed to Heroku and the build process is started. The Overview page for your Heroku app shows real-time status of the current build.\n\n## Congratulations! ðŸŽ‰\n\nYou should now be able to open your new app by pressing [Open App].\n\n## Caveats\n\n### Deploy the STARTER starter project\n\nThis project includes users and authentication. To run it on Heroku we need to add SecureCookies and to login we need to know the login credentials.\n\n#### User credentials\n\nA default administrator is created the first time the app is started, or if the user count is zero. The credentials are printed to the start up log, but only the first time the app is started.\n\nThe Heroku app start log can be reached by pressing [More] and View logs.\n\n```\n2020-03-25T07:19:04.841481+00:00 app[web.1]: User created:\n2020-03-25T07:19:04.841483+00:00 app[web.1]:   email: admin@example.com\n2020-03-25T07:19:04.841483+00:00 app[web.1]:   password: a04ecbcb963d\n2020-03-25T07:19:04.841483+00:00 app[web.1]: Please change these details after initial login.\n```\n\n#### Use secure cookies\n\nTo use secure cookies we need to add below to index.js.\n\n```js\nconst keystone = new Keystone({\n  ...\n  cookie: {\n    secure: true,\n  },\n  cookieSecret: 'very-secret'\n});\n\nmodule.exports = {\n  ...\n  configureExpress: app => {\n    app.set('trust proxy', 1);\n  }\n};\n```\n"}},"__N_SSG":true}